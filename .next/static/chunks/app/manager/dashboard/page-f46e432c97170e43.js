(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9845],{1359:(e,s,a)=>{Promise.resolve().then(a.bind(a,9830))},4436:(e,s,a)=>{"use strict";a.d(s,{k5:()=>o});var i=a(2115),l={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},t=i.createContext&&i.createContext(l),r=["attr","size","title"];function n(){return(n=Object.assign?Object.assign.bind():function(e){for(var s=1;s<arguments.length;s++){var a=arguments[s];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e}).apply(this,arguments)}function c(e,s){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);s&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),a.push.apply(a,i)}return a}function d(e){for(var s=1;s<arguments.length;s++){var a=null!=arguments[s]?arguments[s]:{};s%2?c(Object(a),!0).forEach(function(s){var i,l,t;i=e,l=s,t=a[s],(l=function(e){var s=function(e,s){if("object"!=typeof e||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var i=a.call(e,s||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===s?String:Number)(e)}(e,"string");return"symbol"==typeof s?s:s+""}(l))in i?Object.defineProperty(i,l,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[l]=t}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):c(Object(a)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(a,s))})}return e}function o(e){return s=>i.createElement(h,n({attr:d({},e.attr)},s),function e(s){return s&&s.map((s,a)=>i.createElement(s.tag,d({key:a},s.attr),e(s.child)))}(e.child))}function h(e){var s=s=>{var a,{attr:l,size:t,title:c}=e,o=function(e,s){if(null==e)return{};var a,i,l=function(e,s){if(null==e)return{};var a={};for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){if(s.indexOf(i)>=0)continue;a[i]=e[i]}return a}(e,s);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);for(i=0;i<t.length;i++)a=t[i],!(s.indexOf(a)>=0)&&Object.prototype.propertyIsEnumerable.call(e,a)&&(l[a]=e[a])}return l}(e,r),h=t||s.size||"1em";return s.className&&(a=s.className),e.className&&(a=(a?a+" ":"")+e.className),i.createElement("svg",n({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},s.attr,l,o,{className:a,style:d(d({color:e.color||s.color},s.style),e.style),height:h,width:h,xmlns:"http://www.w3.org/2000/svg"}),c&&i.createElement("title",null,c),e.children)};return void 0!==t?i.createElement(t.Consumer,null,e=>s(e)):s(l)}},9304:()=>{},9830:(e,s,a)=>{"use strict";a.d(s,{default:()=>h});var i=a(5155),l=a(2115),t=a(2108),r=a(6874),n=a.n(r),c=a(6766);a(9304);var d=a(351);let o=e=>{let{status:s}=e;switch(s){case"Pending":return(0,i.jsxs)("span",{className:"status-badge status-pending","aria-label":"Pending",children:[(0,i.jsx)(d.Ohp,{})," Pending"]});case"In Progress":return(0,i.jsxs)("span",{className:"status-badge status-in-progress","aria-label":"In Progress",children:[(0,i.jsx)(d.jTZ,{})," In Progress"]});case"Resolved":return(0,i.jsxs)("span",{className:"status-badge status-resolved","aria-label":"Resolved",children:[(0,i.jsx)(d.A3x,{})," Resolved"]});case"Rejected":return(0,i.jsxs)("span",{className:"status-badge status-rejected","aria-label":"Rejected",children:[(0,i.jsx)(d.q_G,{})," Rejected"]});default:return(0,i.jsx)("span",{className:"status-badge",children:"Unknown"})}},h=()=>{let{data:e,status:s}=(0,t.useSession)(),[a,r]=(0,l.useState)([]),[h,j]=(0,l.useState)(!0),[m,p]=(0,l.useState)(""),[x,u]=(0,l.useState)(""),[v,b]=(0,l.useState)("All"),[g,N]=(0,l.useState)(null),[f,y]=(0,l.useState)(!1),[w,O]=(0,l.useState)("table");(0,l.useEffect)(()=>{let e=setTimeout(()=>{u(m)},300);return()=>clearTimeout(e)},[m]);let P=(0,l.useCallback)(async()=>{j(!0);try{let e=new URLSearchParams;e.append("manager","true");let s=await fetch("/api/complaint?".concat(e.toString()),{method:"GET",headers:{"Content-Type":"application/json"}});if(!s.ok){let e=await s.text();throw console.error("API Error:",s.status,e),Error("Failed to fetch complaints")}let a=await s.json();r(a.complaints||[])}catch(e){console.error("Fetch Error:",e),alert("❌ Could not load complaints.")}finally{j(!1)}},[]);(0,l.useEffect)(()=>{P()},[P]),a.filter(e=>"Resolved"===e.status),a.filter(e=>"Rejected"===e.status);let S=e=>{N(g===e?null:e)},C=a.filter(e=>{var s,a,i,l;let t=x.toLowerCase(),r=(null==(s=e.name)?void 0:s.toLowerCase().includes(t))||(null==(a=e.complaintid)?void 0:a.toString().includes(t))||(null==(i=e.complaintType)?void 0:i.toLowerCase().includes(t))||(null==(l=e.assignedTo)?void 0:l.toLowerCase().includes(t)),n="All"===v||e.status===v;return r&&n});return"loading"===s?(0,i.jsx)("div",{className:"loading-screen",children:"Loading session..."}):e?(0,i.jsxs)("div",{className:"dashboard-container",children:[(0,i.jsxs)("aside",{className:"sidebar","aria-label":"Sidebar Navigation",children:[(0,i.jsx)("div",{className:"sidebar-header",children:(0,i.jsx)("div",{className:"logo",children:(0,i.jsx)("span",{children:"Manager Dashboard"})})}),(0,i.jsxs)("nav",{className:"sidebar-nav","aria-label":"Main navigation",children:[(0,i.jsxs)(n(),{href:"/admin",className:"nav-link active","aria-current":"page",children:[(0,i.jsx)("i",{className:"nav-icon",children:(0,i.jsx)(d.V5Y,{})}),(0,i.jsx)("span",{children:"Dashboard"})]}),(0,i.jsxs)(n(),{href:"/manager/login",className:"nav-link",children:[(0,i.jsx)("i",{className:"nav-icon",children:(0,i.jsx)(d.cfS,{})}),(0,i.jsx)("span",{children:"Manager"})]}),(0,i.jsxs)(n(),{href:"/manager/engineer",className:"nav-link",children:[(0,i.jsx)("i",{className:"nav-icon",children:(0,i.jsx)(d.cfS,{})}),(0,i.jsx)("span",{children:"Engineers"})]})]}),(0,i.jsxs)("div",{className:"sidebar-footer",children:[(0,i.jsxs)("div",{className:"user-profile","aria-label":"User Profile",children:[(0,i.jsx)(c.default,{src:e.user.image||"",width:40,height:40,alt:"".concat(e.user.name," avatar"),className:"user-avatar"}),(0,i.jsxs)("div",{className:"user-details",children:[(0,i.jsx)("strong",{children:e.user.name}),(0,i.jsx)("span",{children:"Manager"})]})]}),(0,i.jsxs)(n(),{href:"/logout",className:"logout-btn","aria-label":"Sign Out",children:[(0,i.jsx)(d.QeK,{})," Sign Out"]})]})]}),(0,i.jsxs)("main",{className:"main-content",role:"main",children:[(0,i.jsx)("header",{className:"content-header",children:(0,i.jsx)("h1",{tabIndex:-1,children:"Complaint Management"})}),(0,i.jsxs)("div",{className:"dashboard-controls",children:[(0,i.jsxs)("div",{className:"search-bar",children:[(0,i.jsx)(d.CKj,{className:"search-icon","aria-hidden":"true"}),(0,i.jsx)("input",{type:"search",placeholder:"Search complaints...",value:m,onChange:e=>p(e.target.value),"aria-label":"Search complaints",disabled:h})]}),(0,i.jsxs)("div",{className:"filter-dropdown",children:[(0,i.jsxs)("button",{className:"filter-toggle",onClick:()=>y(!f),"aria-haspopup":"listbox","aria-expanded":f,"aria-label":"Filter complaints by status",disabled:h,children:[(0,i.jsx)(d.K7R,{})," ",v," ",f?(0,i.jsx)(d.wAb,{}):(0,i.jsx)(d.fK4,{})]}),f&&(0,i.jsx)("div",{className:"filter-options",role:"listbox",tabIndex:-1,children:["All","Pending","In Progress","Resolved","Rejected"].map(e=>(0,i.jsx)("button",{onClick:()=>{b(e),y(!1)},role:"option","aria-selected":v===e,className:v===e?"active":"",children:e},e))})]}),(0,i.jsxs)("div",{className:"view-mode-toggle",role:"group","aria-label":"Toggle view mode",children:[(0,i.jsxs)("button",{onClick:()=>O("table"),"aria-pressed":"table"===w,"aria-label":"Table view",disabled:h,className:"table"===w?"active":"",children:[(0,i.jsx)(d.QPV,{})," Table"]}),(0,i.jsxs)("button",{onClick:()=>O("card"),"aria-pressed":"card"===w,"aria-label":"Card view",disabled:h,className:"card"===w?"active":"",children:[(0,i.jsx)(d.Wm,{})," Card"]})]})]}),(0,i.jsx)("div",{className:"complaints-container","aria-live":"polite","aria-relevant":"additions removals",children:h?(0,i.jsxs)("div",{className:"loading-state",role:"status","aria-live":"polite",children:[(0,i.jsx)("div",{className:"spinner","aria-hidden":"true"}),(0,i.jsx)("p",{children:"Loading complaints..."})]}):0===C.length?(0,i.jsxs)("div",{className:"empty-state",role:"alert","aria-live":"assertive",children:[(0,i.jsx)(d.y3G,{size:48,"aria-hidden":"true"}),(0,i.jsx)("h3",{children:"No complaints found"}),(0,i.jsx)("p",{children:"Try adjusting your search or filter criteria."}),(0,i.jsx)("button",{onClick:()=>{p(""),b("All")},className:"btn btn-primary","aria-label":"Reset filters",children:"Reset Filters"})]}):"table"===w?(0,i.jsx)("div",{className:"table-responsive",children:(0,i.jsxs)("table",{className:"complaints-table",role:"table","aria-label":"Complaints table",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{scope:"col",children:"ID"}),(0,i.jsx)("th",{scope:"col",children:"Customer"}),(0,i.jsx)("th",{scope:"col",children:"Phone"}),(0,i.jsx)("th",{scope:"col",children:"Type"}),(0,i.jsx)("th",{scope:"col",children:"Status"}),(0,i.jsx)("th",{scope:"col",children:"Assigned To"}),(0,i.jsx)("th",{scope:"col",children:"Created At"}),(0,i.jsx)("th",{scope:"col",children:"Actions"})]})}),(0,i.jsx)("tbody",{children:C.map(e=>(0,i.jsxs)(l.Fragment,{children:[(0,i.jsxs)("tr",{children:[(0,i.jsxs)("td",{children:["#",e.complaintid||e._id]}),(0,i.jsx)("td",{children:e.name}),(0,i.jsx)("td",{children:e.phone||"—"}),(0,i.jsx)("td",{children:e.complaintType||"—"}),(0,i.jsx)("td",{children:(0,i.jsx)(o,{status:e.status})}),(0,i.jsx)("td",{children:e.assignedTo||"Unassigned"}),(0,i.jsx)("td",{children:new Date(e.createdAt).toLocaleDateString()}),(0,i.jsx)("td",{children:(0,i.jsxs)("button",{onClick:()=>S(e._id),className:"btn btn-sm btn-details","aria-expanded":g===e._id,"aria-controls":"complaint-details-".concat(e._id),"aria-label":"Toggle details for complaint #".concat(e.complaintid||e._id),disabled:h,children:[g===e._id?(0,i.jsx)(d.wAb,{}):(0,i.jsx)(d.fK4,{})," Details"]})})]}),g===e._id&&(0,i.jsx)("tr",{className:"details-row",id:"complaint-details-".concat(e._id),children:(0,i.jsx)("td",{colSpan:"8",children:(0,i.jsxs)("div",{className:"complaint-details",children:[(0,i.jsxs)("div",{className:"detail-section",children:[(0,i.jsx)("h4",{children:"Description"}),(0,i.jsx)("p",{children:e.description||"No description provided"})]}),(0,i.jsxs)("div",{className:"detail-grid",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h4",{children:"Account Number"}),(0,i.jsx)("p",{children:e.accountNumber||"—"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h4",{children:"User Email"}),(0,i.jsx)("p",{children:e.userEmail||"—"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h4",{children:"Priority"}),(0,i.jsx)("p",{children:e.priority||"—"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h4",{children:"Last Updated"}),(0,i.jsx)("p",{children:new Date(e.updatedAt).toLocaleString()})]})]}),e.engineerMessage&&(0,i.jsxs)("div",{className:"detail-section",children:[(0,i.jsx)("h4",{children:"Engineer Message"}),(0,i.jsx)("p",{children:e.engineerMessage})]}),e.resolutionMessage&&(0,i.jsxs)("div",{className:"detail-section",children:[(0,i.jsx)("h4",{children:"Resolution Message"}),(0,i.jsx)("p",{children:e.resolutionMessage})]})]})})})]},e._id))})]})}):(0,i.jsx)("div",{className:"complaints-list",children:C.map(e=>(0,i.jsxs)("div",{className:"complaint-card","aria-expanded":g===e._id,children:[(0,i.jsxs)("div",{className:"complaint-header",onClick:()=>S(e._id),role:"button",tabIndex:0,onKeyDown:s=>{("Enter"===s.key||" "===s.key)&&S(e._id)},"aria-controls":"complaint-details-card-".concat(e._id),"aria-expanded":g===e._id,children:[(0,i.jsxs)("div",{className:"complaint-id",children:["#",e.complaintid||e._id]}),(0,i.jsxs)("div",{className:"complaint-customer",children:[(0,i.jsx)("strong",{children:e.name}),(0,i.jsx)("span",{children:e.phone||"—"})]}),(0,i.jsx)("div",{className:"complaint-type",children:e.complaintType||"—"}),(0,i.jsx)("div",{className:"complaint-status",children:(0,i.jsx)(o,{status:e.status})}),(0,i.jsx)("div",{className:"complaint-assigned",children:e.assignedTo||"Unassigned"}),(0,i.jsx)("div",{className:"complaint-toggle",children:g===e._id?(0,i.jsx)(d.wAb,{}):(0,i.jsx)(d.fK4,{})})]}),g===e._id&&(0,i.jsxs)("div",{className:"complaint-details",id:"complaint-details-card-".concat(e._id),tabIndex:-1,children:[(0,i.jsxs)("div",{className:"detail-row",children:[(0,i.jsx)("span",{className:"detail-label",children:"Description:"}),(0,i.jsx)("p",{className:"detail-value",children:e.description||"No description provided"})]}),(0,i.jsxs)("div",{className:"detail-row",children:[(0,i.jsx)("span",{className:"detail-label",children:"Account Number:"}),(0,i.jsx)("span",{className:"detail-value",children:e.accountNumber||"—"})]}),(0,i.jsxs)("div",{className:"detail-row",children:[(0,i.jsx)("span",{className:"detail-label",children:"User Email:"}),(0,i.jsx)("span",{className:"detail-value",children:e.userEmail||"—"})]}),(0,i.jsxs)("div",{className:"detail-row",children:[(0,i.jsx)("span",{className:"detail-label",children:"Priority:"}),(0,i.jsx)("span",{className:"detail-value",children:e.priority||"—"})]}),(0,i.jsxs)("div",{className:"detail-row",children:[(0,i.jsx)("span",{className:"detail-label",children:"Created At:"}),(0,i.jsx)("span",{className:"detail-value",children:new Date(e.createdAt).toLocaleString()})]}),(0,i.jsxs)("div",{className:"detail-row",children:[(0,i.jsx)("span",{className:"detail-label",children:"Last Updated:"}),(0,i.jsx)("span",{className:"detail-value",children:new Date(e.updatedAt).toLocaleString()})]}),e.engineerMessage&&(0,i.jsxs)("div",{className:"detail-row",children:[(0,i.jsx)("span",{className:"detail-label",children:"Engineer Message:"}),(0,i.jsx)("span",{className:"detail-value",children:e.engineerMessage})]}),e.resolutionMessage&&(0,i.jsxs)("div",{className:"detail-row",children:[(0,i.jsx)("span",{className:"detail-label",children:"Resolution Message:"}),(0,i.jsx)("span",{className:"detail-value",children:e.resolutionMessage})]})]})]},e._id))})})]})]}):(0,i.jsx)("div",{className:"unauthorized",children:(0,i.jsxs)("div",{className:"unauthorized-card",role:"alert","aria-live":"assertive",children:[(0,i.jsx)(d.y3G,{size:48,className:"text-danger"}),(0,i.jsx)("h2",{children:"Access Denied"}),(0,i.jsx)("p",{children:"You must be logged in to view this page."}),(0,i.jsx)(n(),{href:"/login",className:"btn btn-primary","aria-label":"Go to Login page",children:"Go to Login"})]})})}}},e=>{e.O(0,[9529,844,2108,6874,6766,8441,5964,7358],()=>e(e.s=1359)),_N_E=e.O()}]);