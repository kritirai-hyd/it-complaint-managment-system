(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9845],{1359:(e,s,a)=>{Promise.resolve().then(a.bind(a,9830))},9304:()=>{},9830:(e,s,a)=>{"use strict";a.d(s,{default:()=>h});var l=a(5155),i=a(2115),n=a(2108),r=a(6874),d=a.n(r),t=a(6766);a(9304);var c=a(351);let o=e=>{let{status:s}=e;switch(s){case"Pending":return(0,l.jsxs)("span",{className:"status-badge status-pending","aria-label":"Pending",children:[(0,l.jsx)(c.Ohp,{})," Pending"]});case"In Progress":return(0,l.jsxs)("span",{className:"status-badge status-in-progress","aria-label":"In Progress",children:[(0,l.jsx)(c.jTZ,{})," In Progress"]});case"Resolved":return(0,l.jsxs)("span",{className:"status-badge status-resolved","aria-label":"Resolved",children:[(0,l.jsx)(c.A3x,{})," Resolved"]});case"Rejected":return(0,l.jsxs)("span",{className:"status-badge status-rejected","aria-label":"Rejected",children:[(0,l.jsx)(c.q_G,{})," Rejected"]});default:return(0,l.jsx)("span",{className:"status-badge",children:"Unknown"})}},h=()=>{let{data:e,status:s}=(0,n.useSession)(),[a,r]=(0,i.useState)([]),[h,x]=(0,i.useState)(!0),[j,m]=(0,i.useState)(""),[p,u]=(0,i.useState)(""),[v,g]=(0,i.useState)("All"),[N,b]=(0,i.useState)(null),[w,f]=(0,i.useState)(!1),[y,_]=(0,i.useState)("table");(0,i.useEffect)(()=>{let e=setTimeout(()=>{u(j)},300);return()=>clearTimeout(e)},[j]);let C=(0,i.useCallback)(async()=>{x(!0);try{let e=new URLSearchParams;e.append("manager","true");let s=await fetch("/api/complaint?".concat(e.toString()),{method:"GET",headers:{"Content-Type":"application/json"}});if(!s.ok){let e=await s.text();throw console.error("API Error:",s.status,e),Error("Failed to fetch complaints")}let a=await s.json();r(a.complaints||[])}catch(e){console.error("Fetch Error:",e),alert("❌ Could not load complaints.")}finally{x(!1)}},[]);(0,i.useEffect)(()=>{C()},[C]),a.filter(e=>"Resolved"===e.status),a.filter(e=>"Rejected"===e.status);let S=e=>{b(N===e?null:e)},A=a.filter(e=>{var s,a,l,i;let n=p.toLowerCase(),r=(null==(s=e.name)?void 0:s.toLowerCase().includes(n))||(null==(a=e.complaintid)?void 0:a.toString().includes(n))||(null==(l=e.complaintType)?void 0:l.toLowerCase().includes(n))||(null==(i=e.assignedTo)?void 0:i.toLowerCase().includes(n)),d="All"===v||e.status===v;return r&&d});return"loading"===s?(0,l.jsx)("div",{className:"loading-screen",children:"Loading session..."}):e?(0,l.jsxs)("div",{className:"dashboard-container",children:[(0,l.jsxs)("aside",{className:"sidebar","aria-label":"Sidebar Navigation",children:[(0,l.jsx)("div",{className:"sidebar-header",children:(0,l.jsx)("div",{className:"logo",children:(0,l.jsx)("span",{children:"Manager Dashboard"})})}),(0,l.jsxs)("nav",{className:"sidebar-nav","aria-label":"Main navigation",children:[(0,l.jsxs)(d(),{href:"/admin",className:"nav-link active","aria-current":"page",children:[(0,l.jsx)("i",{className:"nav-icon",children:(0,l.jsx)(c.V5Y,{})}),(0,l.jsx)("span",{children:"Dashboard"})]}),(0,l.jsxs)(d(),{href:"/manager/login",className:"nav-link",children:[(0,l.jsx)("i",{className:"nav-icon",children:(0,l.jsx)(c.cfS,{})}),(0,l.jsx)("span",{children:"Manager"})]}),(0,l.jsxs)(d(),{href:"/manager/engineer",className:"nav-link",children:[(0,l.jsx)("i",{className:"nav-icon",children:(0,l.jsx)(c.cfS,{})}),(0,l.jsx)("span",{children:"Engineers"})]})]}),(0,l.jsxs)("div",{className:"sidebar-footer",children:[(0,l.jsxs)("div",{className:"user-profile","aria-label":"User Profile",children:[(0,l.jsx)(t.default,{src:e.user.image||"",width:40,height:40,alt:"".concat(e.user.name," avatar"),className:"user-avatar"}),(0,l.jsxs)("div",{className:"user-details",children:[(0,l.jsx)("strong",{children:e.user.name}),(0,l.jsx)("span",{children:"Manager"})]})]}),(0,l.jsxs)(d(),{href:"/logout",className:"logout-btn","aria-label":"Sign Out",children:[(0,l.jsx)(c.QeK,{})," Sign Out"]})]})]}),(0,l.jsxs)("main",{className:"main-content",role:"main",children:[(0,l.jsx)("header",{className:"content-header",children:(0,l.jsx)("h1",{tabIndex:-1,children:"Complaint Management"})}),(0,l.jsxs)("div",{className:"dashboard-controls",children:[(0,l.jsxs)("div",{className:"search-bar",children:[(0,l.jsx)(c.CKj,{className:"search-icon","aria-hidden":"true"}),(0,l.jsx)("input",{type:"search",placeholder:"Search complaints...",value:j,onChange:e=>m(e.target.value),"aria-label":"Search complaints",disabled:h})]}),(0,l.jsxs)("div",{className:"filter-dropdown",children:[(0,l.jsxs)("button",{className:"filter-toggle",onClick:()=>f(!w),"aria-haspopup":"listbox","aria-expanded":w,"aria-label":"Filter complaints by status",disabled:h,children:[(0,l.jsx)(c.K7R,{})," ",v," ",w?(0,l.jsx)(c.wAb,{}):(0,l.jsx)(c.fK4,{})]}),w&&(0,l.jsx)("div",{className:"filter-options",role:"listbox",tabIndex:-1,children:["All","Pending","In Progress","Resolved","Rejected"].map(e=>(0,l.jsx)("button",{onClick:()=>{g(e),f(!1)},role:"option","aria-selected":v===e,className:v===e?"active":"",children:e},e))})]}),(0,l.jsxs)("div",{className:"view-mode-toggle",role:"group","aria-label":"Toggle view mode",children:[(0,l.jsxs)("button",{onClick:()=>_("table"),"aria-pressed":"table"===y,"aria-label":"Table view",disabled:h,className:"table"===y?"active":"",children:[(0,l.jsx)(c.QPV,{})," Table"]}),(0,l.jsxs)("button",{onClick:()=>_("card"),"aria-pressed":"card"===y,"aria-label":"Card view",disabled:h,className:"card"===y?"active":"",children:[(0,l.jsx)(c.Wm,{})," Card"]})]})]}),(0,l.jsx)("div",{className:"complaints-container","aria-live":"polite","aria-relevant":"additions removals",children:h?(0,l.jsxs)("div",{className:"loading-state",role:"status","aria-live":"polite",children:[(0,l.jsx)("div",{className:"spinner","aria-hidden":"true"}),(0,l.jsx)("p",{children:"Loading complaints..."})]}):0===A.length?(0,l.jsxs)("div",{className:"empty-state",role:"alert","aria-live":"assertive",children:[(0,l.jsx)(c.y3G,{size:48,"aria-hidden":"true"}),(0,l.jsx)("h3",{children:"No complaints found"}),(0,l.jsx)("p",{children:"Try adjusting your search or filter criteria."}),(0,l.jsx)("button",{onClick:()=>{m(""),g("All")},className:"btn btn-primary","aria-label":"Reset filters",children:"Reset Filters"})]}):"table"===y?(0,l.jsx)("div",{className:"table-responsive",children:(0,l.jsxs)("table",{className:"complaints-table",role:"table","aria-label":"Complaints table",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{scope:"col",children:"ID"}),(0,l.jsx)("th",{scope:"col",children:"Customer"}),(0,l.jsx)("th",{scope:"col",children:"Phone"}),(0,l.jsx)("th",{scope:"col",children:"Type"}),(0,l.jsx)("th",{scope:"col",children:"Status"}),(0,l.jsx)("th",{scope:"col",children:"Assigned To"}),(0,l.jsx)("th",{scope:"col",children:"Created At"}),(0,l.jsx)("th",{scope:"col",children:"Actions"})]})}),(0,l.jsx)("tbody",{children:A.map(e=>(0,l.jsxs)(i.Fragment,{children:[(0,l.jsxs)("tr",{children:[(0,l.jsxs)("td",{children:["#",e.complaintid||e._id]}),(0,l.jsx)("td",{children:e.name}),(0,l.jsx)("td",{children:e.phone||"—"}),(0,l.jsx)("td",{children:e.complaintType||"—"}),(0,l.jsx)("td",{children:(0,l.jsx)(o,{status:e.status})}),(0,l.jsx)("td",{children:e.assignedTo||"Unassigned"}),(0,l.jsx)("td",{children:new Date(e.createdAt).toLocaleDateString()}),(0,l.jsx)("td",{children:(0,l.jsxs)("button",{onClick:()=>S(e._id),className:"btn btn-sm btn-details","aria-expanded":N===e._id,"aria-controls":"complaint-details-".concat(e._id),"aria-label":"Toggle details for complaint #".concat(e.complaintid||e._id),disabled:h,children:[N===e._id?(0,l.jsx)(c.wAb,{}):(0,l.jsx)(c.fK4,{})," Details"]})})]}),N===e._id&&(0,l.jsx)("tr",{className:"details-row",id:"complaint-details-".concat(e._id),children:(0,l.jsx)("td",{colSpan:"8",children:(0,l.jsxs)("div",{className:"complaint-details",children:[(0,l.jsxs)("div",{className:"detail-section",children:[(0,l.jsx)("h4",{children:"Description"}),(0,l.jsx)("p",{children:e.description||"No description provided"})]}),(0,l.jsxs)("div",{className:"detail-grid",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{children:"Account Number"}),(0,l.jsx)("p",{children:e.accountNumber||"—"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{children:"User Email"}),(0,l.jsx)("p",{children:e.userEmail||"—"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{children:"Priority"}),(0,l.jsx)("p",{children:e.priority||"—"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{children:"Last Updated"}),(0,l.jsx)("p",{children:new Date(e.updatedAt).toLocaleString()})]})]}),e.engineerMessage&&(0,l.jsxs)("div",{className:"detail-section",children:[(0,l.jsx)("h4",{children:"Engineer Message"}),(0,l.jsx)("p",{children:e.engineerMessage})]}),e.resolutionMessage&&(0,l.jsxs)("div",{className:"detail-section",children:[(0,l.jsx)("h4",{children:"Resolution Message"}),(0,l.jsx)("p",{children:e.resolutionMessage})]})]})})})]},e._id))})]})}):(0,l.jsx)("div",{className:"complaints-list",children:A.map(e=>(0,l.jsxs)("div",{className:"complaint-card","aria-expanded":N===e._id,children:[(0,l.jsxs)("div",{className:"complaint-header",onClick:()=>S(e._id),role:"button",tabIndex:0,onKeyDown:s=>{("Enter"===s.key||" "===s.key)&&S(e._id)},"aria-controls":"complaint-details-card-".concat(e._id),"aria-expanded":N===e._id,children:[(0,l.jsxs)("div",{className:"complaint-id",children:["#",e.complaintid||e._id]}),(0,l.jsxs)("div",{className:"complaint-customer",children:[(0,l.jsx)("strong",{children:e.name}),(0,l.jsx)("span",{children:e.phone||"—"})]}),(0,l.jsx)("div",{className:"complaint-type",children:e.complaintType||"—"}),(0,l.jsx)("div",{className:"complaint-status",children:(0,l.jsx)(o,{status:e.status})}),(0,l.jsx)("div",{className:"complaint-assigned",children:e.assignedTo||"Unassigned"}),(0,l.jsx)("div",{className:"complaint-toggle",children:N===e._id?(0,l.jsx)(c.wAb,{}):(0,l.jsx)(c.fK4,{})})]}),N===e._id&&(0,l.jsxs)("div",{className:"complaint-details",id:"complaint-details-card-".concat(e._id),tabIndex:-1,children:[(0,l.jsxs)("div",{className:"detail-row",children:[(0,l.jsx)("span",{className:"detail-label",children:"Description:"}),(0,l.jsx)("p",{className:"detail-value",children:e.description||"No description provided"})]}),(0,l.jsxs)("div",{className:"detail-row",children:[(0,l.jsx)("span",{className:"detail-label",children:"Account Number:"}),(0,l.jsx)("span",{className:"detail-value",children:e.accountNumber||"—"})]}),(0,l.jsxs)("div",{className:"detail-row",children:[(0,l.jsx)("span",{className:"detail-label",children:"User Email:"}),(0,l.jsx)("span",{className:"detail-value",children:e.userEmail||"—"})]}),(0,l.jsxs)("div",{className:"detail-row",children:[(0,l.jsx)("span",{className:"detail-label",children:"Priority:"}),(0,l.jsx)("span",{className:"detail-value",children:e.priority||"—"})]}),(0,l.jsxs)("div",{className:"detail-row",children:[(0,l.jsx)("span",{className:"detail-label",children:"Created At:"}),(0,l.jsx)("span",{className:"detail-value",children:new Date(e.createdAt).toLocaleString()})]}),(0,l.jsxs)("div",{className:"detail-row",children:[(0,l.jsx)("span",{className:"detail-label",children:"Last Updated:"}),(0,l.jsx)("span",{className:"detail-value",children:new Date(e.updatedAt).toLocaleString()})]}),e.engineerMessage&&(0,l.jsxs)("div",{className:"detail-row",children:[(0,l.jsx)("span",{className:"detail-label",children:"Engineer Message:"}),(0,l.jsx)("span",{className:"detail-value",children:e.engineerMessage})]}),e.resolutionMessage&&(0,l.jsxs)("div",{className:"detail-row",children:[(0,l.jsx)("span",{className:"detail-label",children:"Resolution Message:"}),(0,l.jsx)("span",{className:"detail-value",children:e.resolutionMessage})]})]})]},e._id))})})]})]}):(0,l.jsx)("div",{className:"unauthorized",children:(0,l.jsxs)("div",{className:"unauthorized-card",role:"alert","aria-live":"assertive",children:[(0,l.jsx)(c.y3G,{size:48,className:"text-danger"}),(0,l.jsx)("h2",{children:"Access Denied"}),(0,l.jsx)("p",{children:"You must be logged in to view this page."}),(0,l.jsx)(d(),{href:"/login",className:"btn btn-primary","aria-label":"Go to Login page",children:"Go to Login"})]})})}}},e=>{e.O(0,[9529,844,2108,6874,5751,8441,5964,7358],()=>e(e.s=1359)),_N_E=e.O()}]);