(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5957],{34:(e,s,a)=>{"use strict";a.d(s,{default:()=>d});var n=a(5155),r=a(2115),t=a(6874),l=a.n(t),i=a(2108),c=a(6766),o=a(351);a(4960);let d=()=>{let{data:e,status:s}=(0,i.useSession)(),[a,t]=(0,r.useState)([]),[d,h]=(0,r.useState)(!0),[m,j]=(0,r.useState)({}),[x,u]=(0,r.useState)("all"),[p,g]=(0,r.useState)(""),[v,b]=(0,r.useState)(""),[f,y]=(0,r.useState)(null);(0,r.useEffect)(()=>{N()},[]);let N=async()=>{h(!0);try{let e=await fetch("/api/complaint?admin=true"),s=await e.json();if(!e.ok)throw Error(s.message||"Failed to load complaints");t(s.complaints||[])}catch(e){b(e.message)}finally{h(!1)}},w=[{name:"Couponszone",email:"info@couponszone.coin"},{name:"Anada Rai",email:"anada@gmail.com"},{name:"Suraj Bhardwaj",email:"suraj@example.com"},{name:"Vikash Gupta",email:"vikash@example.com"},{name:"Tek Chand",email:"tek@example.com"},{name:"Abhishek Shah",email:"abhishek@example.com"},{name:"Prashanto",email:"prashanto@example.com"},{name:"Aadarsh Dubey",email:"aadarsh@example.com"},{name:"Gaurav Choudary",email:"gaurav@example.com"},{name:"Rahul Kumar",email:"rahul@example.com"}],O=async(e,s)=>{let a=m[s];if(!(null==a?void 0:a.name)||!(null==a?void 0:a.email))return void alert("⚠️ Please enter both engineer name and email.");try{let s=await fetch("/api/complaint/".concat(e),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"In Progress",assignedTo:a.name.trim(),assignedToEmail:a.email.trim().toLowerCase()})});if(!s.ok){let e="Assignment failed",a=await s.text();try{let s=JSON.parse(a);e=(null==s?void 0:s.error)||e}catch(e){}throw Error(e)}alert("✅ Complaint assigned successfully"),N()}catch(e){console.error("Assignment Error:",e),alert("❌ "+e.message)}},C=e=>{switch(e.toLowerCase()){case"pending":return(0,n.jsxs)("span",{className:"status-badge status-pending",children:[(0,n.jsx)(o.Ohp,{})," Pending"]});case"in progress":return(0,n.jsxs)("span",{className:"status-badge status-in-progress",children:[(0,n.jsx)(o.jTZ,{})," In Progress"]});case"resolved":return(0,n.jsxs)("span",{className:"status-badge status-resolved",children:[(0,n.jsx)(o.A3x,{})," Resolved"]});default:return(0,n.jsx)("span",{className:"status-badge",children:e})}},P=a.filter(e=>{let s="all"===x||e.status.toLowerCase()===x.toLowerCase(),a=""===p||Object.values(e).some(e=>e&&e.toString().toLowerCase().includes(p.toLowerCase()));return s&&a});return"loading"===s?(0,n.jsxs)("div",{className:"loading-overlay",children:[(0,n.jsx)("div",{className:"spinner"}),(0,n.jsx)("p",{children:"Loading session..."})]}):e?(0,n.jsxs)("div",{className:"a-dashboard",children:[(0,n.jsxs)("aside",{className:"a-sidebar",children:[(0,n.jsx)("div",{className:"logo",children:(0,n.jsx)("span",{children:"Admin"})}),(0,n.jsxs)("nav",{children:[(0,n.jsxs)(l(),{href:"/admin",className:"active",children:[(0,n.jsx)("i",{children:(0,n.jsx)(o.V5Y,{})}),(0,n.jsx)("span",{children:"Dashboard"})]}),(0,n.jsxs)(l(),{href:"/admin/login",children:[(0,n.jsx)("i",{children:(0,n.jsx)(o.cfS,{})}),(0,n.jsx)("span",{children:"Manager"})]}),(0,n.jsxs)(l(),{href:"/admin/login",children:[(0,n.jsx)("i",{children:(0,n.jsx)(o.cfS,{})}),(0,n.jsx)("span",{children:"Engineer Management"})]})]}),(0,n.jsx)("div",{className:"sidebar-footer",children:(0,n.jsxs)("div",{className:"user-profile",children:[e.user.image?(0,n.jsx)(c.default,{src:e.user.image,width:40,height:40,alt:"User",className:"user-avatar"}):(0,n.jsx)("div",{className:"user-avatar-placeholder",children:"\uD83D\uDC64"}),(0,n.jsxs)("div",{className:"user-details",children:[(0,n.jsx)("strong",{children:e.user.name}),(0,n.jsx)("span",{children:"Admin"})]})]})})]}),(0,n.jsxs)("main",{className:"main",children:[(0,n.jsxs)("header",{className:"header",children:[(0,n.jsx)("h1",{children:"All Complaints"}),(0,n.jsxs)("div",{className:"header-actions",children:[(0,n.jsxs)("div",{className:"search-bar",children:[(0,n.jsx)("input",{type:"text",placeholder:"Search complaints...",value:p,onChange:e=>g(e.target.value)}),(0,n.jsx)("button",{className:"search-btn",children:(0,n.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",children:[(0,n.jsx)("circle",{cx:"11",cy:"11",r:"8"}),(0,n.jsx)("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]})})]}),(0,n.jsx)("div",{className:"user-info",children:(0,n.jsxs)("span",{children:["Welcome back, ",(0,n.jsx)("strong",{children:e.user.name})]})})]})]}),(0,n.jsxs)("div",{className:"content-header",children:[(0,n.jsx)("h2",{children:"Complaints Overview"}),(0,n.jsx)("div",{className:"tabs",children:["all","pending","in progress","resolved"].map(e=>(0,n.jsx)("button",{className:x===e?"active":"",onClick:()=>u(e),children:e.charAt(0).toUpperCase()+e.slice(1)},e))})]}),(0,n.jsxs)("div",{className:"stats-cards",children:[(0,n.jsxs)("div",{className:"stat-card",children:[(0,n.jsx)("h3",{children:"Total Complaints"}),(0,n.jsx)("p",{children:a.length})]}),(0,n.jsxs)("div",{className:"stat-card",children:[(0,n.jsx)("h3",{children:"Pending"}),(0,n.jsx)("p",{children:a.filter(e=>"Pending"===e.status).length})]}),(0,n.jsxs)("div",{className:"stat-card",children:[(0,n.jsx)("h3",{children:"In Progress"}),(0,n.jsx)("p",{children:a.filter(e=>"In Progress"===e.status).length})]}),(0,n.jsxs)("div",{className:"stat-card",children:[(0,n.jsx)("h3",{children:"Resolved"}),(0,n.jsx)("p",{children:a.filter(e=>"Resolved"===e.status).length})]})]}),d?(0,n.jsxs)("div",{className:"loading-state",children:[(0,n.jsx)("div",{className:"spinner"}),(0,n.jsx)("p",{children:"Loading complaints..."})]}):0===P.length?(0,n.jsxs)("div",{className:"empty-state",children:[(0,n.jsx)(o.y3G,{size:48}),(0,n.jsx)("h3",{children:"No complaints found"}),(0,n.jsx)("p",{children:"There are currently no complaints matching your criteria."}),(0,n.jsxs)("button",{onClick:N,className:"btn btn-primary",children:[(0,n.jsx)(o.jTZ,{})," Refresh"]})]}):(0,n.jsx)("div",{className:"complaint-table-container",children:(0,n.jsx)("div",{className:"complaint-table-wrapper",children:(0,n.jsxs)("table",{className:"complaint-table",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"Complaint ID"}),(0,n.jsx)("th",{children:"Customer"}),(0,n.jsx)("th",{children:"Title"}),(0,n.jsx)("th",{children:"Type"}),(0,n.jsx)("th",{children:"Status"}),(0,n.jsx)("th",{children:"Assigned To"}),(0,n.jsx)("th",{children:"Actions"})]})}),(0,n.jsx)("tbody",{children:P.map(e=>{var s,a;let t=e.complaintId,l=e.complaintId||t,i={name:(null==(s=m[l])?void 0:s.name)||"",email:(null==(a=m[l])?void 0:a.email)||""};return"Resolved"===e.status||"In Progress"===e.status?(0,n.jsxs)("tr",{children:[(0,n.jsxs)("td",{className:"font-mono",children:["Complaint ID: ",l]}),(0,n.jsx)("td",{children:(0,n.jsxs)("div",{className:"customer-cell",children:[(0,n.jsx)("strong",{children:e.name}),(0,n.jsx)("span",{children:e.phone||"—"})]})}),(0,n.jsx)("td",{children:e.title||"—"}),(0,n.jsx)("td",{children:e.complaintType||"—"}),(0,n.jsx)("td",{children:C(e.status)}),(0,n.jsx)("td",{children:e.assignedTo||"—"}),(0,n.jsx)("td",{children:"—"})]},t):(0,n.jsxs)(r.Fragment,{children:[(0,n.jsxs)("tr",{children:[(0,n.jsxs)("td",{className:"font-mono",children:["Complaint ID: ",l]}),(0,n.jsx)("td",{children:(0,n.jsxs)("div",{className:"customer-cell",children:[(0,n.jsx)("strong",{children:e.name}),(0,n.jsx)("span",{children:e.phone||"—"})]})}),(0,n.jsx)("td",{children:e.title||"—"}),(0,n.jsx)("td",{children:e.complaintType||"—"}),(0,n.jsx)("td",{children:C(e.status)}),(0,n.jsx)("td",{children:e.assignedTo||"Unassigned"}),(0,n.jsx)("td",{children:(0,n.jsxs)("div",{className:"assignment-form",children:[(0,n.jsxs)("select",{value:i.name&&i.email?"".concat(i.name,"|").concat(i.email):"",onChange:e=>((e,s)=>{let[a,n]=e.target.value.split("|");j(e=>({...e,[s]:{name:a,email:n}}))})(e,l),className:"form-select",children:[(0,n.jsx)("option",{value:"",hidden:!0,children:"Select Engineer"}),w.map(e=>(0,n.jsx)("option",{value:"".concat(e.name,"|").concat(e.email),children:e.name},e.email))]}),(0,n.jsx)("button",{onClick:()=>O(t,l),className:"btn btn-primary btn-sm",disabled:!i.name||!i.email,children:"Assign"}),(0,n.jsx)("button",{onClick:()=>(e=>{y(s=>s===e?null:e)})(l),className:"btn btn-primary btn-sm",style:{backgroundColor:"#5da827ff"},children:f===l?"Hide Details":"View Details"})]})})]}),f===l&&(0,n.jsx)("tr",{className:"bg-gray-100",children:(0,n.jsxs)("td",{colSpan:7,className:"p-4",children:[(0,n.jsx)("strong",{children:"Description:"})," ",e.description||"—",(0,n.jsx)("br",{}),(0,n.jsx)("br",{}),(0,n.jsx)("strong",{children:"Attachments:"})," ",e.attachments&&e.attachments.length>0?(0,n.jsx)("ul",{children:e.attachments.map(e=>(0,n.jsx)("li",{children:(0,n.jsx)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",children:e.name})},e._id))}):"—",(0,n.jsx)("br",{}),(0,n.jsx)("br",{}),(0,n.jsx)("strong",{children:"Company Address:"})," ",e.companyAddress||"—",(0,n.jsx)("br",{}),(0,n.jsx)("br",{}),(0,n.jsx)("strong",{children:"Location:"})," ",e.location||"—"]})})]},t)})})]})})})]})]}):(0,n.jsxs)("div",{className:"unauthorized",children:[(0,n.jsx)("h2",{children:"Access Denied"}),(0,n.jsx)("p",{children:"You must be logged in to view this page."}),(0,n.jsx)(l(),{href:"/login",className:"btn btn-primary",children:"Go to Login"})]})}},4436:(e,s,a)=>{"use strict";a.d(s,{k5:()=>d});var n=a(2115),r={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},t=n.createContext&&n.createContext(r),l=["attr","size","title"];function i(){return(i=Object.assign?Object.assign.bind():function(e){for(var s=1;s<arguments.length;s++){var a=arguments[s];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function c(e,s){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);s&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),a.push.apply(a,n)}return a}function o(e){for(var s=1;s<arguments.length;s++){var a=null!=arguments[s]?arguments[s]:{};s%2?c(Object(a),!0).forEach(function(s){var n,r,t;n=e,r=s,t=a[s],(r=function(e){var s=function(e,s){if("object"!=typeof e||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,s||"default");if("object"!=typeof n)return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===s?String:Number)(e)}(e,"string");return"symbol"==typeof s?s:s+""}(r))in n?Object.defineProperty(n,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[r]=t}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):c(Object(a)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(a,s))})}return e}function d(e){return s=>n.createElement(h,i({attr:o({},e.attr)},s),function e(s){return s&&s.map((s,a)=>n.createElement(s.tag,o({key:a},s.attr),e(s.child)))}(e.child))}function h(e){var s=s=>{var a,{attr:r,size:t,title:c}=e,d=function(e,s){if(null==e)return{};var a,n,r=function(e,s){if(null==e)return{};var a={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(s.indexOf(n)>=0)continue;a[n]=e[n]}return a}(e,s);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);for(n=0;n<t.length;n++)a=t[n],!(s.indexOf(a)>=0)&&Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}(e,l),h=t||s.size||"1em";return s.className&&(a=s.className),e.className&&(a=(a?a+" ":"")+e.className),n.createElement("svg",i({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},s.attr,r,d,{className:a,style:o(o({color:e.color||s.color},s.style),e.style),height:h,width:h,xmlns:"http://www.w3.org/2000/svg"}),c&&n.createElement("title",null,c),e.children)};return void 0!==t?n.createElement(t.Consumer,null,e=>s(e)):s(r)}},4960:()=>{},5019:(e,s,a)=>{Promise.resolve().then(a.bind(a,34))}},e=>{e.O(0,[3697,844,2108,6874,6766,8441,5964,7358],()=>e(e.s=5019)),_N_E=e.O()}]);