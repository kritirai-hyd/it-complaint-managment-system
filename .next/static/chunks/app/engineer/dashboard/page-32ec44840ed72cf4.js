(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2321],{4070:(e,s,a)=>{"use strict";a.d(s,{default:()=>d});var r=a(5155),t=a(351),n=a(2115),l=a(2108);a(7800);var i=a(6874),c=a.n(i),o=a(6766);let d=()=>{let{data:e,status:s}=(0,l.useSession)(),[a,i]=(0,n.useState)([]),[d,m]=(0,n.useState)(!0),[h,p]=(0,n.useState)(""),[u,j]=(0,n.useState)(null),[v,x]=(0,n.useState)(null),g=(0,n.useCallback)(async e=>{if(e){m(!0),p("");try{let s=await fetch("/api/complaint/engineer?name=".concat(encodeURIComponent(e))),a=await s.json();if(!s.ok)throw Error(a.error||"Failed to fetch complaints.");i(a.complaints||[])}catch(e){p(e.message||"Something went wrong")}finally{m(!1)}}},[]);(0,n.useEffect)(()=>{var s,a;let r=null==e||null==(a=e.user)||null==(s=a.name)?void 0:s.trim();r&&g(r)},[e,g]);let b=async(s,a,r)=>{if(!s||isNaN(s))return alert("Invalid complaint ID.");if(!(null==r?void 0:r.trim()))return alert("Please enter a message.");j(s);try{let t=await fetch("/api/complaint/resolve-reject/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:s,status:"resolve"===a?"Resolved":"Rejected",engineerMessage:r})}),n=await t.json();if(!t.ok)throw Error(n.error||"Failed to update complaint.");alert("Complaint ".concat("resolve"===a?"resolved":"rejected"," successfully.")),g(e.user.name.trim())}catch(e){alert("Error: "+e.message)}finally{j(null),x(null)}},f=e=>{x(v===e?null:e)};return"loading"===s?(0,r.jsx)("div",{className:"loading-screen",children:"Loading session..."}):e?(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{className:"e-dashboard",children:[(0,r.jsxs)("aside",{className:"a-sidebar",children:[(0,r.jsx)("div",{className:"logo",children:(0,r.jsx)("span",{children:"Engineer Dashboard"})}),(0,r.jsxs)("nav",{children:[(0,r.jsxs)(c(),{href:"/admin",className:"active",children:[(0,r.jsx)("i",{children:(0,r.jsx)(t.V5Y,{})}),(0,r.jsx)("span",{children:"Dashboard"})]}),(0,r.jsxs)(c(),{href:"/admin/login",children:[(0,r.jsx)("i",{children:(0,r.jsx)(t.cfS,{})}),(0,r.jsx)("span",{children:"Manager"})]}),(0,r.jsxs)(c(),{href:"/admin/login",children:[(0,r.jsx)("i",{children:(0,r.jsx)(t.cfS,{})}),(0,r.jsx)("span",{children:"Engineer Management"})]})]}),(0,r.jsx)("div",{className:"sidebar-footer",children:(0,r.jsxs)("div",{className:"user-profile",children:[e.user.image?(0,r.jsx)(o.default,{src:e.user.image,width:40,height:40,alt:"User",className:"user-avatar"}):(0,r.jsxs)("div",{className:"user-avatar-placeholder",children:[" "," "]}),(0,r.jsxs)("div",{className:"user-details",children:[(0,r.jsx)("strong",{children:e.user.name}),(0,r.jsx)("span",{children:"Admin"})]})]})})]}),(0,r.jsxs)("div",{className:"engineer-dashboard-container",children:[(0,r.jsxs)("header",{className:"dashboard-header",children:[(0,r.jsx)("h1",{children:"Engineer Dashboard"}),(0,r.jsxs)("div",{className:"user-info",children:[(0,r.jsxs)("span",{className:"welcome-message",children:["Welcome, ",e.user.name]}),(0,r.jsx)("span",{className:"user-role",children:"Engineer"})]})]}),(0,r.jsxs)("main",{className:"dashboard-content",children:[d&&(0,r.jsxs)("div",{className:"loading-overlay",children:[(0,r.jsx)("div",{className:"spinner"}),(0,r.jsx)("p",{children:"Loading complaints..."})]}),h&&(0,r.jsxs)("div",{className:"error-alert",children:[(0,r.jsx)("span",{className:"error-icon",children:"⚠️"}),(0,r.jsx)("p",{children:h}),(0,r.jsx)("button",{onClick:()=>g(e.user.name.trim()),className:"retry-btn",children:"Retry"})]}),!d&&!h&&0===a.length&&(0,r.jsxs)("div",{className:"empty-state",children:[(0,r.jsx)("img",{src:"/empty-state.svg",alt:"No complaints",className:"empty-state-image"}),(0,r.jsx)("h3",{children:"No complaints assigned to you"}),(0,r.jsx)("p",{children:"When new complaints are assigned, they'll appear here."})]}),!d&&a.length>0&&(0,r.jsxs)("div",{className:"complaints-container",children:[(0,r.jsxs)("div",{className:"complaints-header",children:[(0,r.jsx)("h3",{children:"Your Assigned Complaints"}),(0,r.jsxs)("span",{className:"badge-count",children:[a.length," total"]})]}),(0,r.jsx)("div",{className:"complaints-list",children:a.map((e,s)=>{var a,t;let n=null!=(a=e.complaintId)?a:s,l="in progress"===(e.status||"").toLowerCase(),i=v===n,c=u===n;return(0,r.jsxs)("div",{className:"complaint-card ".concat(i?"expanded":""),children:[(0,r.jsxs)("div",{className:"complaint-summary",onClick:()=>f(n),children:[(0,r.jsxs)("div",{className:"complaint-id",children:["ID: ",null!=(t=e.complaintId)?t:"N/A"]}),(0,r.jsx)("div",{className:"complaint-type",children:e.complaintType||"—"}),(0,r.jsx)("div",{className:"complaint-status ".concat((e=>({pending:"badge-pending","in progress":"badge-in-progress",resolved:"badge-resolved",rejected:"badge-rejected"})[null==e?void 0:e.toLowerCase()]||"badge-default")(e.status)),children:e.status||"—"}),(0,r.jsx)("div",{className:"complaint-actions",children:l?(0,r.jsx)("button",{className:"action-indicator",onClick:e=>{e.stopPropagation(),f(n)},children:"Action Required"}):(0,r.jsx)("span",{className:"no-action",children:"View Details"})})]}),i&&(0,r.jsxs)("div",{className:"complaint-details",children:[(0,r.jsxs)("div",{className:"detail-row",children:[(0,r.jsx)("span",{className:"detail-label",children:"Name:"}),(0,r.jsx)("span",{children:e.name||"—"})]}),(0,r.jsxs)("div",{className:"detail-row",children:[(0,r.jsx)("span",{className:"detail-label",children:"Phone:"}),(0,r.jsx)("span",{children:e.phone||"—"})]}),(0,r.jsxs)("div",{className:"detail-row",children:[(0,r.jsx)("span",{className:"detail-label",children:"Title:"}),(0,r.jsx)("span",{children:e.title||"—"})]}),(0,r.jsxs)("div",{className:"detail-row",children:[(0,r.jsx)("span",{className:"detail-label",children:"Description:"}),(0,r.jsx)("p",{className:"complaint-description",children:e.description||"No description provided."})]}),(0,r.jsxs)("div",{className:"detail-row",children:[(0,r.jsx)("span",{className:"detail-label",children:"Attachments:"}),(0,r.jsxs)("div",{className:"complaint-description",children:[e.attachments&&e.attachments.length>0?(0,r.jsx)("ul",{children:e.attachments.map(e=>(0,r.jsx)("li",{style:{listStyle:"none"},children:(0,r.jsx)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",children:e.name})},e._id))}):"—"," "]})]}),l&&(0,r.jsxs)("form",{className:"action-form",onSubmit:e=>{e.preventDefault();let s=e.target.engineerMessage.value.trim();b(n,e.nativeEvent.submitter.value,s)},children:[(0,r.jsxs)("div",{className:"form-group",children:[(0,r.jsx)("label",{htmlFor:"message-".concat(n),children:"Resolution Notes"}),(0,r.jsx)("textarea",{id:"message-".concat(n),name:"engineerMessage",placeholder:"Enter your response or resolution details...",required:!0,disabled:c,rows:3})]}),(0,r.jsxs)("div",{className:"action-buttons",children:[(0,r.jsx)("button",{type:"submit",value:"resolve",className:"btn-resolve",disabled:c,children:c?(0,r.jsx)("span",{className:"btn-loader"}):"Resolve Complaint"}),(0,r.jsx)("button",{type:"submit",value:"reject",className:"btn-reject",disabled:c,children:c?(0,r.jsx)("span",{className:"btn-loader"}):"Reject Complaint"})]})]})]})]},n)})})]})]})]})]})}):(0,r.jsx)("div",{className:"auth-error",children:"You are not logged in."})}},4436:(e,s,a)=>{"use strict";a.d(s,{k5:()=>d});var r=a(2115),t={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},n=r.createContext&&r.createContext(t),l=["attr","size","title"];function i(){return(i=Object.assign?Object.assign.bind():function(e){for(var s=1;s<arguments.length;s++){var a=arguments[s];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function c(e,s){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);s&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),a.push.apply(a,r)}return a}function o(e){for(var s=1;s<arguments.length;s++){var a=null!=arguments[s]?arguments[s]:{};s%2?c(Object(a),!0).forEach(function(s){var r,t,n;r=e,t=s,n=a[s],(t=function(e){var s=function(e,s){if("object"!=typeof e||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var r=a.call(e,s||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===s?String:Number)(e)}(e,"string");return"symbol"==typeof s?s:s+""}(t))in r?Object.defineProperty(r,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):r[t]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):c(Object(a)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(a,s))})}return e}function d(e){return s=>r.createElement(m,i({attr:o({},e.attr)},s),function e(s){return s&&s.map((s,a)=>r.createElement(s.tag,o({key:a},s.attr),e(s.child)))}(e.child))}function m(e){var s=s=>{var a,{attr:t,size:n,title:c}=e,d=function(e,s){if(null==e)return{};var a,r,t=function(e,s){if(null==e)return{};var a={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){if(s.indexOf(r)>=0)continue;a[r]=e[r]}return a}(e,s);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(r=0;r<n.length;r++)a=n[r],!(s.indexOf(a)>=0)&&Object.prototype.propertyIsEnumerable.call(e,a)&&(t[a]=e[a])}return t}(e,l),m=n||s.size||"1em";return s.className&&(a=s.className),e.className&&(a=(a?a+" ":"")+e.className),r.createElement("svg",i({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},s.attr,t,d,{className:a,style:o(o({color:e.color||s.color},s.style),e.style),height:m,width:m,xmlns:"http://www.w3.org/2000/svg"}),c&&r.createElement("title",null,c),e.children)};return void 0!==n?r.createElement(n.Consumer,null,e=>s(e)):s(t)}},4741:(e,s,a)=>{Promise.resolve().then(a.bind(a,4070))},7800:()=>{}},e=>{e.O(0,[6601,844,2108,6874,6766,8441,5964,7358],()=>e(e.s=4741)),_N_E=e.O()}]);