(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2321],{4070:(e,s,a)=>{"use strict";a.d(s,{default:()=>o});var l=a(5155),n=a(351),t=a(2115),i=a(2108);a(7800);var r=a(6874),c=a.n(r),d=a(6766);let o=()=>{var e,s;let{data:a,status:r}=(0,i.useSession)(),[o,m]=(0,t.useState)([]),[h,j]=(0,t.useState)(!0),[u,x]=(0,t.useState)(""),[p,v]=(0,t.useState)(null),[N,g]=(0,t.useState)(null),[b,f]=(0,t.useState)(!1),[C,w]=(0,t.useState)("all"),[y,k]=(0,t.useState)(!1),E=(0,t.useCallback)(async e=>{if(e){j(!0),x("");try{let s=await fetch("/api/complaint/engineer?name=".concat(encodeURIComponent(e))),a=await s.json();if(!s.ok)throw Error(a.error||"Failed to fetch complaints.");m(a.complaints||[])}catch(e){x(e.message||"Something went wrong")}finally{j(!1)}}},[]);(0,t.useEffect)(()=>{var e,s;let l=null==a||null==(s=a.user)||null==(e=s.name)?void 0:e.trim();l&&E(l)},[a,E]);let S=async(e,s,l)=>{if(!e||isNaN(e))return alert("Invalid complaint ID.");if(!(null==l?void 0:l.trim()))return alert("Please enter a message.");v(e);try{let n=await fetch("/api/complaint/resolve-reject/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,status:"resolve"===s?"Resolved":"Rejected",engineerMessage:l})}),t=await n.json();if(!n.ok)throw Error(t.error||"Failed to update complaint.");alert("Complaint ".concat("resolve"===s?"resolved":"rejected"," successfully.")),E(a.user.name.trim())}catch(e){alert("Error: "+e.message)}finally{v(null),g(null)}},L=e=>{g(N===e?null:e)},R=()=>{f(!b)},A=o.filter(e=>{var s;return"all"===C||(null==(s=e.status)?void 0:s.toLowerCase())===C.toLowerCase()}),D={all:o.length,pending:o.filter(e=>{var s;return(null==(s=e.status)?void 0:s.toLowerCase())==="pending"}).length,"in progress":o.filter(e=>{var s;return(null==(s=e.status)?void 0:s.toLowerCase())==="in progress"}).length,resolved:o.filter(e=>{var s;return(null==(s=e.status)?void 0:s.toLowerCase())==="resolved"}).length,rejected:o.filter(e=>{var s;return(null==(s=e.status)?void 0:s.toLowerCase())==="rejected"}).length};return"loading"===r?(0,l.jsx)("div",{className:"loading-screen",children:"Loading session..."}):a?(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("div",{className:"e-dashboard",children:[(0,l.jsxs)("header",{className:"mobile-header",children:[(0,l.jsx)("button",{className:"menu-toggle",onClick:R,children:b?(0,l.jsx)(n.yGN,{}):(0,l.jsx)(n.ND1,{})}),(0,l.jsx)("h1",{children:"Engineer Dashboard"}),(0,l.jsx)("div",{className:"user-avatar-mobile",children:a.user.image?(0,l.jsx)(d.default,{src:a.user.image,width:36,height:36,alt:"User",className:"avatar-image"}):(0,l.jsx)("div",{className:"avatar-placeholder",children:null==(e=a.user.name)?void 0:e.charAt(0).toUpperCase()})})]}),b&&(0,l.jsx)("div",{className:"sidebar-overlay",onClick:R}),(0,l.jsxs)("aside",{className:"a-sidebar ".concat(b?"sidebar-open":""),children:[(0,l.jsx)("div",{className:"logo",children:(0,l.jsx)("span",{children:"Engineer Dashboard"})}),(0,l.jsx)("nav",{children:(0,l.jsxs)(c(),{href:"/engineer",className:"active",onClick:()=>f(!1),children:[(0,l.jsx)("i",{children:(0,l.jsx)(n.V5Y,{})}),(0,l.jsx)("span",{children:"Dashboard"})]})}),(0,l.jsxs)("div",{className:"sidebar-footer",children:[(0,l.jsxs)("div",{className:"user-profile",children:[a.user.image?(0,l.jsx)(d.default,{src:a.user.image,width:40,height:40,alt:"User",className:"user-avatar"}):(0,l.jsx)("div",{className:"user-avatar-placeholder",children:null==(s=a.user.name)?void 0:s.charAt(0).toUpperCase()}),(0,l.jsxs)("div",{className:"user-details",children:[(0,l.jsx)("strong",{children:a.user.name}),(0,l.jsx)("span",{children:"Engineer"})]})]}),(0,l.jsxs)("button",{className:"logout-btn",onClick:()=>(0,i.signOut)(),children:[(0,l.jsx)(n.QeK,{}),(0,l.jsx)("span",{children:"Logout"})]})]})]}),(0,l.jsxs)("div",{className:"engineer-dashboard-container",children:[(0,l.jsxs)("header",{className:"dashboard-header",children:[(0,l.jsxs)("div",{className:"header-content",children:[(0,l.jsxs)("h1",{children:["Welcome, ",a.user.name]}),(0,l.jsx)("p",{children:"Here are your assigned complaints"})]}),(0,l.jsxs)("div",{className:"stats-container",children:[(0,l.jsxs)("div",{className:"stat-card",children:[(0,l.jsx)("span",{className:"stat-number",children:o.length}),(0,l.jsx)("span",{className:"stat-label",children:"Total Complaints"})]}),(0,l.jsxs)("div",{className:"stat-card",children:[(0,l.jsx)("span",{className:"stat-number",children:D["in progress"]}),(0,l.jsx)("span",{className:"stat-label",children:"Require Action"})]})]})]}),(0,l.jsxs)("main",{className:"dashboard-content",children:[(0,l.jsxs)("div",{className:"filters-container ".concat(y?"filters-visible":""),children:[(0,l.jsxs)("button",{className:"filter-btn ".concat("all"===C?"active":""),onClick:()=>{w("all"),k(!1)},children:["All (",D.all,")"]}),(0,l.jsxs)("button",{className:"filter-btn ".concat("pending"===C?"active":""),onClick:()=>{w("pending"),k(!1)},children:["Pending (",D.pending,")"]}),(0,l.jsxs)("button",{className:"filter-btn ".concat("in progress"===C?"active":""),onClick:()=>{w("in progress"),k(!1)},children:["In Progress (",D["in progress"],")"]}),(0,l.jsxs)("button",{className:"filter-btn ".concat("resolved"===C?"active":""),onClick:()=>{w("resolved"),k(!1)},children:["Resolved (",D.resolved,")"]}),(0,l.jsxs)("button",{className:"filter-btn ".concat("rejected"===C?"active":""),onClick:()=>{w("rejected"),k(!1)},children:["Rejected (",D.rejected,")"]})]}),h&&(0,l.jsxs)("div",{className:"loading-overlay",children:[(0,l.jsx)("div",{className:"spinner"}),(0,l.jsx)("p",{children:"Loading complaints..."})]}),u&&(0,l.jsxs)("div",{className:"error-alert",children:[(0,l.jsx)("span",{className:"error-icon",children:"⚠️"}),(0,l.jsx)("p",{children:u}),(0,l.jsx)("button",{onClick:()=>E(a.user.name.trim()),className:"retry-btn",children:"Retry"})]}),!h&&!u&&0===A.length&&(0,l.jsxs)("div",{className:"empty-state",children:[(0,l.jsx)("div",{className:"empty-icon",children:(0,l.jsx)(n.QuH,{})}),(0,l.jsx)("h3",{children:"No complaints found"}),(0,l.jsx)("p",{children:"There are no complaints matching your current filter."})]}),!h&&A.length>0&&(0,l.jsxs)("div",{className:"complaints-container",children:[(0,l.jsxs)("div",{className:"complaints-header",children:[(0,l.jsx)("h3",{children:"Your Assigned Complaints"}),(0,l.jsxs)("span",{className:"badge-count",children:[A.length," shown"]})]}),(0,l.jsx)("div",{className:"complaints-list",children:A.map((e,s)=>{var a,t;let i=null!=(a=e.complaintId)?a:s,r="in progress"===(e.status||"").toLowerCase(),c=N===i,d=p===i;return(0,l.jsxs)("div",{className:"complaint-card ".concat(c?"expanded":""),children:[(0,l.jsxs)("div",{className:"complaint-summary",onClick:()=>L(i),children:[(0,l.jsxs)("div",{className:"complaint-meta",children:[(0,l.jsxs)("div",{className:"complaint-id",children:["ID: ",null!=(t=e.complaintId)?t:"N/A"]}),(0,l.jsx)("div",{className:"complaint-type",children:e.complaintType||"—"})]}),(0,l.jsxs)("div",{className:"complaint-status-container",children:[(0,l.jsx)("div",{className:"complaint-status ".concat((e=>({pending:"badge-pending","in progress":"badge-in-progress",resolved:"badge-resolved",rejected:"badge-rejected"})[null==e?void 0:e.toLowerCase()]||"badge-default")(e.status)),children:e.status||"—"}),(0,l.jsx)("div",{className:"complaint-actions",children:r?(0,l.jsx)("button",{className:"action-indicator",onClick:e=>{e.stopPropagation(),L(i)},children:"Action Required"}):(0,l.jsx)("span",{className:"no-action",children:"View Details"})})]})]}),c&&(0,l.jsxs)("div",{className:"complaint-details",children:[(0,l.jsxs)("div",{className:"detail-grid",children:[(0,l.jsxs)("div",{className:"detail-item",children:[(0,l.jsx)("span",{className:"detail-label",children:"Name:"}),(0,l.jsx)("span",{children:e.name||"—"})]}),(0,l.jsxs)("div",{className:"detail-item",children:[(0,l.jsx)("span",{className:"detail-label",children:"Phone:"}),(0,l.jsx)("span",{children:e.phone||"—"})]}),(0,l.jsxs)("div",{className:"detail-item",children:[(0,l.jsx)("span",{className:"detail-label",children:"Title:"}),(0,l.jsx)("span",{children:e.title||"—"})]}),(0,l.jsxs)("div",{className:"detail-item full-width",children:[(0,l.jsx)("span",{className:"detail-label",children:"Description:"}),(0,l.jsx)("p",{className:"complaint-description",children:e.description||"No description provided."})]}),(0,l.jsxs)("div",{className:"detail-item full-width",children:[(0,l.jsx)("span",{className:"detail-label",children:"Attachments:"}),(0,l.jsx)("div",{className:"attachments-list",children:e.attachments&&e.attachments.length>0?e.attachments.map(e=>(0,l.jsxs)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"attachment-link",children:[(0,l.jsx)(n.QuH,{}),e.name]},e._id)):"—"})]})]}),r&&(0,l.jsxs)("form",{className:"action-form",onSubmit:e=>{e.preventDefault();let s=e.target.engineerMessage.value.trim();S(i,e.nativeEvent.submitter.value,s)},children:[(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsxs)("label",{htmlFor:"message-".concat(i),children:[(0,l.jsx)(n.mEP,{}),"Resolution Notes"]}),(0,l.jsx)("textarea",{id:"message-".concat(i),name:"engineerMessage",placeholder:"Enter your response or resolution details...",required:!0,disabled:d,rows:3})]}),(0,l.jsxs)("div",{className:"action-buttons",children:[(0,l.jsx)("button",{type:"submit",value:"resolve",className:"btn-resolve",disabled:d,children:d?(0,l.jsx)("span",{className:"btn-loader"}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.A3x,{}),"Resolve"]})}),(0,l.jsx)("button",{type:"submit",value:"reject",className:"btn-reject",disabled:d,children:d?(0,l.jsx)("span",{className:"btn-loader"}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.q_G,{}),"Reject"]})})]})]})]})]},i)})})]})]})]})]})}):(0,l.jsx)("div",{className:"auth-error",children:"You are not logged in."})}},4741:(e,s,a)=>{Promise.resolve().then(a.bind(a,4070))},7800:()=>{}},e=>{e.O(0,[6601,844,2108,6874,5751,8441,5964,7358],()=>e(e.s=4741)),_N_E=e.O()}]);