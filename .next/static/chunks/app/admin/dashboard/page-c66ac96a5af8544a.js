(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5957],{34:(e,s,a)=>{"use strict";a.d(s,{default:()=>o});var l=a(5155),n=a(2115),i=a(6874),r=a.n(i),t=a(2108),c=a(6766),d=a(351);a(4960);let o=()=>{let{data:e,status:s}=(0,t.useSession)(),[a,i]=(0,n.useState)([]),[o,h]=(0,n.useState)(!0),[m,x]=(0,n.useState)({}),[j,p]=(0,n.useState)("all"),[u,v]=(0,n.useState)(""),[g,b]=(0,n.useState)(""),[N,f]=(0,n.useState)(null),[y,C]=(0,n.useState)(!1),[w,k]=(0,n.useState)(!1);(0,n.useEffect)(()=>(S(),A(),window.addEventListener("resize",A),()=>window.removeEventListener("resize",A)),[]);let A=()=>{C(window.innerWidth<=768)},S=async()=>{h(!0);try{let e=await fetch("/api/complaint?admin=true"),s=await e.json();if(!e.ok)throw Error(s.message||"Failed to load complaints");i(s.complaints||[])}catch(e){b(e.message)}finally{h(!1)}},T=[{name:"Couponszone",email:"info@couponszone.coin"},{name:"Anada Rai",email:"anada@gmail.com"},{name:"Suraj Bhardwaj",email:"suraj@example.com"},{name:"Vikash Gupta",email:"vikash@example.com"},{name:"Tek Chand",email:"tek@example.com"},{name:"Abhishek Shah",email:"abhishek@example.com"},{name:"Prashanto",email:"prashanto@example.com"},{name:"Aadarsh Dubey",email:"aadarsh@example.com"},{name:"Gaurav Choudary",email:"gaurav@example.com"},{name:"Rahul Kumar",email:"rahul@example.com"}],D=e=>{f(s=>s===e?null:e)},P=(e,s)=>{let[a,l]=e.target.value.split("|");x(e=>({...e,[s]:{name:a,email:l}}))},E=async(e,s)=>{let a=m[s];if(!(null==a?void 0:a.name)||!(null==a?void 0:a.email))return void alert("⚠️ Please enter both engineer name and email.");try{let s=await fetch("/api/complaint/".concat(e),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"In Progress",assignedTo:a.name.trim(),assignedToEmail:a.email.trim().toLowerCase()})});if(!s.ok){let e="Assignment failed",a=await s.text();try{let s=JSON.parse(a);e=(null==s?void 0:s.error)||e}catch(e){}throw Error(e)}alert("✅ Complaint assigned successfully"),S()}catch(e){console.error("Assignment Error:",e),alert("❌ "+e.message)}},I=e=>{switch(e.toLowerCase()){case"pending":return(0,l.jsxs)("span",{className:"status-badge status-pending",children:[(0,l.jsx)(d.Ohp,{})," Pending"]});case"in progress":return(0,l.jsxs)("span",{className:"status-badge status-in-progress",children:[(0,l.jsx)(d.jTZ,{})," In Progress"]});case"resolved":return(0,l.jsxs)("span",{className:"status-badge status-resolved",children:[(0,l.jsx)(d.A3x,{})," Resolved"]});default:return(0,l.jsx)("span",{className:"status-badge",children:e})}},L=a.filter(e=>{let s="all"===j||e.status.toLowerCase()===j.toLowerCase(),a=""===u||Object.values(e).some(e=>e&&e.toString().toLowerCase().includes(u.toLowerCase()));return s&&a});return"loading"===s?(0,l.jsxs)("div",{className:"loading-overlay",children:[(0,l.jsx)("div",{className:"spinner"}),(0,l.jsx)("p",{children:"Loading session..."})]}):e?(0,l.jsxs)("div",{className:"a-dashboard",children:[y&&(0,l.jsxs)("div",{className:"mobile-header",children:[(0,l.jsx)("button",{className:"menu-toggle",onClick:()=>k(!w),children:w?(0,l.jsx)(d.yGN,{size:24}):(0,l.jsx)(d.ND1,{size:24})}),(0,l.jsx)("h1",{children:"Admin Dashboard"}),(0,l.jsx)("div",{className:"user-avatar-mobile",children:e.user.image?(0,l.jsx)(c.default,{src:e.user.image,width:32,height:32,alt:"User",className:"user-avatar"}):(0,l.jsx)("div",{className:"user-avatar-placeholder",children:(0,l.jsx)(d.cfS,{})})})]}),(0,l.jsxs)("aside",{className:"a-sidebar ".concat(w?"sidebar-open":""),children:[(0,l.jsxs)("div",{className:"logo",children:[(0,l.jsx)("span",{children:"Admin"}),y&&(0,l.jsx)("button",{className:"sidebar-close",onClick:()=>k(!1),children:(0,l.jsx)(d.yGN,{size:20})})]}),(0,l.jsx)("nav",{children:(0,l.jsxs)(r(),{href:"/admin",className:"active",onClick:()=>y&&k(!1),children:[(0,l.jsx)("i",{children:(0,l.jsx)(d.V5Y,{})}),(0,l.jsx)("span",{children:"Dashboard"})]})}),(0,l.jsx)("div",{className:"sidebar-footer",children:(0,l.jsxs)("div",{className:"user-profile",children:[e.user.image?(0,l.jsx)(c.default,{src:e.user.image,width:40,height:40,alt:"User",className:"user-avatar"}):(0,l.jsx)("div",{className:"user-avatar-placeholder",children:(0,l.jsx)(d.cfS,{})}),(0,l.jsxs)("div",{className:"user-details",children:[(0,l.jsx)("strong",{children:e.user.name}),(0,l.jsx)("span",{children:"Admin"})]})]})})]}),y&&w&&(0,l.jsx)("div",{className:"sidebar-overlay",onClick:()=>k(!1)}),(0,l.jsxs)("main",{className:"main",children:[(0,l.jsxs)("header",{className:"header",children:[!y&&(0,l.jsx)("h1",{children:"All Complaints"}),(0,l.jsxs)("div",{className:"header-actions",children:[(0,l.jsxs)("div",{className:"search-bar",children:[(0,l.jsx)("input",{type:"text",placeholder:"Search complaints...",value:u,onChange:e=>v(e.target.value)}),(0,l.jsx)("button",{className:"search-btn",children:(0,l.jsx)(d.CKj,{size:16})})]}),!y&&(0,l.jsx)("div",{className:"user-info",children:(0,l.jsxs)("span",{children:["Welcome back, ",(0,l.jsx)("strong",{children:e.user.name})]})})]})]}),(0,l.jsxs)("div",{className:"content-header",children:[(0,l.jsx)("h2",{children:"Complaints Overview"}),(0,l.jsx)("div",{className:"tabs",children:["all","pending","in progress","resolved"].map(e=>(0,l.jsx)("button",{className:j===e?"active":"",onClick:()=>p(e),children:e.charAt(0).toUpperCase()+e.slice(1)},e))})]}),(0,l.jsxs)("div",{className:"stats-cards",children:[(0,l.jsxs)("div",{className:"stat-card",children:[(0,l.jsx)("h3",{style:{color:"blue"},children:"Total Complaints"}),(0,l.jsx)("p",{style:{color:"blue"},children:a.length})]}),(0,l.jsxs)("div",{className:"stat-card",children:[(0,l.jsx)("h3",{style:{color:"#b35801"},children:"Pending"}),(0,l.jsx)("p",{style:{color:"#b35801"},children:a.filter(e=>"Pending"===e.status).length})]}),(0,l.jsxs)("div",{className:"stat-card",children:[(0,l.jsx)("h3",{style:{color:"#5900ab"},children:"In Progress"}),(0,l.jsx)("p",{style:{color:"#5900ab"},children:a.filter(e=>"In Progress"===e.status).length})]}),(0,l.jsxs)("div",{className:"stat-card",children:[(0,l.jsx)("h3",{style:{color:"green"},children:"Resolved"}),(0,l.jsx)("p",{style:{color:"green"},children:a.filter(e=>"Resolved"===e.status).length})]})]}),o?(0,l.jsxs)("div",{className:"loading-state",children:[(0,l.jsx)("div",{className:"spinner"}),(0,l.jsx)("p",{children:"Loading complaints..."})]}):0===L.length?(0,l.jsxs)("div",{className:"empty-state",children:[(0,l.jsx)(d.y3G,{size:48}),(0,l.jsx)("h3",{children:"No complaints found"}),(0,l.jsx)("p",{children:"There are currently no complaints matching your criteria."}),(0,l.jsxs)("button",{onClick:S,className:"btn btn-primary",children:[(0,l.jsx)(d.jTZ,{})," Refresh"]})]}):y?(0,l.jsx)("div",{className:"complaint-cards",children:L.map(e=>{var s,a;let n=e.complaintId,i=e.complaintId||n,r={name:(null==(s=m[i])?void 0:s.name)||"",email:(null==(a=m[i])?void 0:a.email)||""};return(0,l.jsxs)("div",{className:"complaint-card",children:[(0,l.jsxs)("div",{className:"card-header",children:[(0,l.jsxs)("div",{className:"complaint-id",children:["ID: ",i]}),(0,l.jsx)("div",{className:"status-wrapper",children:I(e.status)})]}),(0,l.jsxs)("div",{className:"card-content",children:[(0,l.jsxs)("div",{className:"card-field",children:[(0,l.jsx)("label",{children:"Customer:"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("strong",{children:e.name}),e.phone&&(0,l.jsx)("div",{children:e.phone})]})]}),(0,l.jsxs)("div",{className:"card-field",children:[(0,l.jsx)("label",{children:"Title:"}),(0,l.jsx)("span",{children:e.title||"—"})]}),(0,l.jsxs)("div",{className:"card-field",children:[(0,l.jsx)("label",{children:"Type:"}),(0,l.jsx)("span",{children:e.complaintType||"—"})]}),(0,l.jsxs)("div",{className:"card-field",children:[(0,l.jsx)("label",{children:"Assigned To:"}),(0,l.jsx)("span",{children:e.assignedTo||"Unassigned"})]}),("Pending"===e.status||!e.status)&&(0,l.jsxs)("div",{className:"card-field",children:[(0,l.jsx)("label",{children:"Assign Engineer:"}),(0,l.jsxs)("select",{value:r.name&&r.email?"".concat(r.name,"|").concat(r.email):"",onChange:e=>P(e,i),className:"form-select",children:[(0,l.jsx)("option",{value:"",hidden:!0,children:"Select Engineer"}),T.map(e=>(0,l.jsx)("option",{value:"".concat(e.name,"|").concat(e.email),children:e.name},e.email))]})]}),(0,l.jsxs)("div",{className:"card-actions",children:[("Pending"===e.status||!e.status)&&(0,l.jsx)("button",{onClick:()=>E(n,i),className:"btn btn-primary btn-sm",disabled:!r.name||!r.email,children:"Assign"}),(0,l.jsxs)("button",{onClick:()=>D(i),className:"btn btn-primary btn-sm",style:{backgroundColor:"#5da827ff"},children:[N===i?"Hide Details":"View Details",N===i?(0,l.jsx)(d.wAb,{}):(0,l.jsx)(d.fK4,{})]})]}),N===i&&(0,l.jsxs)("div",{className:"card-details",children:[(0,l.jsxs)("div",{className:"card-field",children:[(0,l.jsx)("label",{children:"Description:"}),(0,l.jsx)("p",{children:e.description||"—"})]}),(0,l.jsxs)("div",{className:"card-field",children:[(0,l.jsx)("label",{children:"Attachments:"}),e.attachments&&e.attachments.length>0?(0,l.jsx)("ul",{children:e.attachments.map(e=>(0,l.jsx)("li",{children:(0,l.jsx)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",children:e.name})},e._id))}):(0,l.jsx)("span",{children:"—"})]}),(0,l.jsxs)("div",{className:"card-field",children:[(0,l.jsx)("label",{children:"Company Address:"}),(0,l.jsx)("span",{children:e.companyAddress||"—"})]}),(0,l.jsxs)("div",{className:"card-field",children:[(0,l.jsx)("label",{children:"Location:"}),(0,l.jsx)("span",{children:e.location||"—"})]})]})]})]},n)})}):(0,l.jsx)("div",{className:"complaint-table-container",children:(0,l.jsx)("div",{className:"complaint-table-wrapper",children:(0,l.jsxs)("table",{className:"complaint-table",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{children:"Complaint ID"}),(0,l.jsx)("th",{children:"Customer"}),(0,l.jsx)("th",{children:"Title"}),(0,l.jsx)("th",{children:"Type"}),(0,l.jsx)("th",{children:"Status"}),(0,l.jsx)("th",{children:"Assigned To"}),(0,l.jsx)("th",{children:"Actions"})]})}),(0,l.jsx)("tbody",{children:L.map(e=>{var s,a;let i=e.complaintId,r=e.complaintId||i,t={name:(null==(s=m[r])?void 0:s.name)||"",email:(null==(a=m[r])?void 0:a.email)||""};return"Resolved"===e.status||"In Progress"===e.status?(0,l.jsxs)("tr",{children:[(0,l.jsxs)("td",{className:"font-mono",children:["Complaint ID: ",r]}),(0,l.jsx)("td",{children:(0,l.jsxs)("div",{className:"customer-cell",children:[(0,l.jsx)("strong",{children:e.name}),(0,l.jsx)("span",{children:e.phone||"—"})]})}),(0,l.jsx)("td",{children:e.title||"—"}),(0,l.jsx)("td",{children:e.complaintType||"—"}),(0,l.jsx)("td",{children:I(e.status)}),(0,l.jsx)("td",{children:e.assignedTo||"—"}),(0,l.jsx)("td",{children:"—"})]},i):(0,l.jsxs)(n.Fragment,{children:[(0,l.jsxs)("tr",{children:[(0,l.jsxs)("td",{className:"font-mono",children:["Complaint ID: ",r]}),(0,l.jsx)("td",{children:(0,l.jsxs)("div",{className:"customer-cell",children:[(0,l.jsx)("strong",{children:e.name}),(0,l.jsx)("span",{children:e.phone||"—"})]})}),(0,l.jsx)("td",{children:e.title||"—"}),(0,l.jsx)("td",{children:e.complaintType||"—"}),(0,l.jsx)("td",{children:I(e.status)}),(0,l.jsx)("td",{children:e.assignedTo||"Unassigned"}),(0,l.jsx)("td",{children:(0,l.jsxs)("div",{className:"assignment-form",children:[(0,l.jsxs)("select",{value:t.name&&t.email?"".concat(t.name,"|").concat(t.email):"",onChange:e=>P(e,r),className:"form-select",children:[(0,l.jsx)("option",{value:"",hidden:!0,children:"Select Engineer"}),T.map(e=>(0,l.jsx)("option",{value:"".concat(e.name,"|").concat(e.email),children:e.name},e.email))]}),(0,l.jsx)("button",{onClick:()=>E(i,r),className:"btn btn-primary btn-sm",disabled:!t.name||!t.email,children:"Assign"}),(0,l.jsx)("button",{onClick:()=>D(r),className:"btn btn-primary btn-sm",style:{backgroundColor:"#5da827ff"},children:N===r?"Hide Details":"View Details"})]})})]}),N===r&&(0,l.jsx)("tr",{className:"bg-gray-100",children:(0,l.jsxs)("td",{colSpan:7,className:"p-4",children:[(0,l.jsx)("strong",{children:"Description:"})," ",e.description||"—",(0,l.jsx)("br",{}),(0,l.jsx)("br",{}),(0,l.jsx)("strong",{children:"Attachments:"})," ",e.attachments&&e.attachments.length>0?(0,l.jsx)("ul",{children:e.attachments.map(e=>(0,l.jsx)("li",{children:(0,l.jsx)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",children:e.name})},e._id))}):"—",(0,l.jsx)("br",{}),(0,l.jsx)("br",{}),(0,l.jsx)("strong",{children:"Company Address:"})," ",e.companyAddress||"—",(0,l.jsx)("br",{}),(0,l.jsx)("br",{}),(0,l.jsx)("strong",{children:"Location:"})," ",e.location||"—"]})})]},i)})})]})})})]})]}):(0,l.jsxs)("div",{className:"unauthorized",children:[(0,l.jsx)("h2",{children:"Access Denied"}),(0,l.jsx)("p",{children:"You must be logged in to view this page."}),(0,l.jsx)(r(),{href:"/login",className:"btn btn-primary",children:"Go to Login"})]})}},4960:()=>{},5019:(e,s,a)=>{Promise.resolve().then(a.bind(a,34))}},e=>{e.O(0,[3697,844,2108,6874,5751,8441,5964,7358],()=>e(e.s=5019)),_N_E=e.O()}]);