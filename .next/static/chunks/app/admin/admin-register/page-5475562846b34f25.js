(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1096],{2015:()=>{},3410:(e,r,a)=>{"use strict";a.d(r,{default:()=>d});var t=a(5155),s=a(2115),n=a(5695),l=a(3464),i=a(6874),o=a.n(i);a(2015);let d=()=>{let e=(0,n.useRouter)(),r=(0,s.useRef)(null),[a,i]=(0,s.useState)(1),[d,c]=(0,s.useState)({name:"",email:"",phone:"",password:"",confirmPassword:"",role:"",otp:""}),[u,p]=(0,s.useState)(!1),[m,h]=(0,s.useState)({text:"",type:""}),[x,y]=(0,s.useState)(!1),[v,f]=(0,s.useState)(30),[g,j]=(0,s.useState)(0);(0,s.useEffect)(()=>{2===a&&r.current&&(r.current.focus(),b())},[a]),(0,s.useEffect)(()=>{let e=null;return x&&v>0?e=setInterval(()=>f(e=>e-1),1e3):0===v&&(y(!1),f(30),clearInterval(e)),()=>clearInterval(e)},[x,v]),(0,s.useEffect)(()=>{if(u){let e=setInterval(()=>{j(e=>Math.min(e+10,1===a?50:90))},300);return()=>clearInterval(e)}j(0)},[u,a]);let b=()=>{y(!0),f(30)},N=e=>{c({...d,[e.target.name]:e.target.value}),h({text:"",type:""})},w=async e=>{var r,a,t;if(e.preventDefault(),p(!0),h({text:"",type:""}),!(d.name&&d.email&&d.phone&&d.password&&d.confirmPassword&&d.role?d.password!==d.confirmPassword?(h({text:"Passwords do not match.",type:"error"}),!1):d.password.length<6?(h({text:"Password must be at least 6 characters.",type:"error"}),!1):/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(d.email)?!!/^[0-9]{10,15}$/.test(d.phone)||(h({text:"Please enter a valid phone number.",type:"error"}),!1):(h({text:"Please enter a valid email address.",type:"error"}),!1):(h({text:"All fields are required.",type:"error"}),!1)))return void p(!1);try{let e=await l.A.post("/api/admin/request-otp",{name:d.name,email:d.email,phone:d.phone,password:d.password,role:d.role});200===e.status?(i(2),h({text:"OTP sent to your email. Please verify.",type:"success"})):h({text:(null==(r=e.data)?void 0:r.error)||"Registration failed.",type:"error"})}catch(e){h({text:(null==(t=e.response)||null==(a=t.data)?void 0:a.error)||"An error occurred during registration.",type:"error"})}finally{p(!1)}},P=async r=>{var a,t,s;if(r.preventDefault(),p(!0),h({text:"",type:""}),!d.otp||!/^\d{6}$/.test(d.otp.trim())){h({text:"Please enter a valid 6-digit OTP.",type:"error"}),p(!1);return}try{let r=await l.A.post("/api/admin/verify-otp",{email:d.email,otp:d.otp});200===r.status?(j(100),h({text:"Registration successful! Redirecting to login...",type:"success"}),setTimeout(()=>{e.push("/admin/login")},2e3)):h({text:(null==(a=r.data)?void 0:a.error)||"OTP verification failed.",type:"error"})}catch(e){h({text:(null==(s=e.response)||null==(t=s.data)?void 0:t.error)||"An error occurred during OTP verification.",type:"error"})}finally{p(!1)}},C=async()=>{var e,r,a;if(!x){p(!0),h({text:"",type:""});try{let r=await l.A.post("/api/admin/request-otp",{name:d.name,email:d.email,phone:d.phone,password:d.password,role:d.role});200===r.status?(h({text:"New OTP sent to your email.",type:"success"}),b()):h({text:(null==(e=r.data)?void 0:e.error)||"Failed to resend OTP.",type:"error"})}catch(e){h({text:(null==(a=e.response)||null==(r=a.data)?void 0:r.error)||"An error occurred while resending OTP.",type:"error"})}finally{p(!1)}}};return(0,t.jsx)("div",{className:"register-container",children:(0,t.jsxs)("div",{className:"register-card",children:[(0,t.jsx)("div",{className:"progress-bar",style:{width:"".concat(g,"%")}}),(0,t.jsxs)("div",{className:"register-header",children:[(0,t.jsx)("h2",{children:1===a?"Create Admin Account":"Verify Email"}),(0,t.jsx)("p",{className:"subtitle",children:1===a?"Join us today!":"Enter the code sent to ".concat(d.email)})]}),m.text&&(0,t.jsx)("div",{className:"message ".concat(m.type,"-message"),children:m.text}),1===a?(0,t.jsxs)("form",{onSubmit:w,className:"register-form",children:[(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{children:"Full Name"}),(0,t.jsx)("input",{name:"name",required:!0,value:d.name,placeholder:"Enter your full name",onChange:N,disabled:u})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{children:"Email"}),(0,t.jsx)("input",{type:"email",name:"email",value:d.email,placeholder:"Enter your email",onChange:N,required:!0,disabled:u})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{children:"Phone Number"}),(0,t.jsx)("input",{name:"phone",required:!0,value:d.phone,placeholder:"Enter your phone number",onChange:N,disabled:u})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{children:"Password"}),(0,t.jsx)("input",{type:"password",name:"password",value:d.password,placeholder:"Create a password (min 6 characters)",onChange:N,required:!0,disabled:u})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{children:"Confirm Password"}),(0,t.jsx)("input",{type:"password",name:"confirmPassword",value:d.confirmPassword,placeholder:"Confirm your password",onChange:N,required:!0,disabled:u})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{children:"Role"}),(0,t.jsxs)("select",{name:"role",required:!0,value:d.role,onChange:N,disabled:u,children:[(0,t.jsx)("option",{value:"",children:"-- Select Role --"}),(0,t.jsx)("option",{value:"admin",children:"Admin"}),(0,t.jsx)("option",{value:"manager",children:"Manager"}),(0,t.jsx)("option",{value:"engineer",children:"Engineer"})]})]}),(0,t.jsx)("button",{type:"submit",disabled:u,className:"btn-primary",children:u?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"spinner"}),"Sending OTP..."]}):"Continue"})]}):(0,t.jsxs)("form",{onSubmit:P,className:"register-form",children:[(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{children:"Verification Code"}),(0,t.jsx)("input",{name:"otp",type:"text",maxLength:6,required:!0,ref:r,value:d.otp,onChange:N,inputMode:"numeric",pattern:"\\d{6}",autoComplete:"one-time-code",placeholder:"Enter 6-digit OTP",disabled:u,className:"otp-input"})]}),(0,t.jsxs)("div",{className:"button-group",children:[(0,t.jsx)("button",{type:"submit",disabled:u,className:"btn-primary",children:u?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"spinner"}),"Verifying..."]}):"Verify & Create Account"}),(0,t.jsx)("button",{type:"button",onClick:()=>{i(1),h({text:"",type:""})},disabled:u,className:"btn-secondary",children:"Back"})]}),(0,t.jsx)("div",{className:"resend-container",children:(0,t.jsxs)("button",{type:"button",onClick:C,disabled:x||u,className:"resend-button",children:["Resend OTP ",x?"(".concat(v,"s)"):""]})}),(0,t.jsx)("p",{className:"otp-note",children:"Didn't receive the code? Check your spam folder or try again."})]}),(0,t.jsxs)("div",{className:"login-link",children:["Already have an account? ",(0,t.jsx)(o(),{href:"/admin/login",children:"Login here"})]})]})})}},8899:(e,r,a)=>{Promise.resolve().then(a.bind(a,3410))}},e=>{e.O(0,[1590,6874,794,8441,5964,7358],()=>e(e.s=8899)),_N_E=e.O()}]);